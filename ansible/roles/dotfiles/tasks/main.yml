---
# Dotfiles

- name: Register current branch
  command: git rev-parse --abbrev-ref HEAD chdir={{ dotfiles.path }}
  register: dotfiles_branch
  ignore_errors: true

- name: Download from repo
  git: repo={{ dotfiles.repo }} dest={{ dotfiles.path }} version=master force=no recursive=yes
  when: dotfiles_branch|failed

- name: Get the list of dotfiles excluding .git, .gitignore and .gitmodules
  shell: find {{ dotfiles.path }} -maxdepth 1 -not -path '*/.git' -not -path '*/.gitignore' -not -path '*/.gitmodules' -iname '.*' -exec basename {} \;
  register: dotfiles_find

- name: Link dotfiles
  file: src={{ dotfiles.path }}/{{ item }} dest=~/{{ item }} state=link force=yes
  with_items: '{{ dotfiles_find.stdout_lines }}'

- name: Link ~/.config/nvim to ~/.vim
  file: src=~/.vim dest=~/.config/nvim state=link force=yes
